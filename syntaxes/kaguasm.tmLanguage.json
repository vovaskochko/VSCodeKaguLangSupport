{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "KaguOS Assembler",
	"patterns": [
		{
			"include": "#comments"
		},
		{
			"include": "#write-command"
		},
		{
			"include": "#copy-command"
		},
		{
			"include": "#jump-commands"
		},
		{
			"include": "#label-declaration"
		},
		{
			"include": "#var-declaration"
		},
		{
			"include": "#standalone-commands"
		}
	],
	"repository": {
		"comments": {
			"begin": "//",
			"end": "$",
			"name": "comment.line.double-slash.kaguasm"
		},
		"write-command": {
			"begin": "^\\s*(write)\\b",
			"beginCaptures": {
				"1": { "name": "keyword.control.kaguasm" }
			},
			"end": "$",
			"patterns": [
				{
					"match": "\\s+(\"(?:[^\"\\\\]|\\\\.)*\"|-?\\d+|OP_\\w+|SYS_CALL_\\w+|COLOR_\\w+|KEYBOARD_READ_\\w+|label:\\w+)\\s+(to)\\s+(\\*?(?:REG_\\w+|DISPLAY_\\w+|KEYBOARD_BUFFER|PROGRAM_COUNTER|SYS_ENERGY|FREE_\\w+|KERNEL_START|var:\\w+|-?\\d+))",
					"captures": {
						"1": {
							"patterns": [
								{
									"match": "\"(?:[^\"\\\\]|\\\\.)*\"",
									"name": "string.quoted.double.kaguasm"
								},
								{
									"match": "label:\\w+",
									"name": "string.other.label.kaguasm"
								},
								{
									"match": ".+",
									"name": "constant.numeric.kaguasm"
								}
							]
						},
						"2": { "name": "keyword.control.kaguasm" },
						"3": {
							"patterns": [
								{
									"match": "\\*?var:\\w+",
									"name": "variable.other.kaguasm"
								},
								{
									"match": ".+",
									"name": "constant.numeric.kaguasm"
								}
							]
						}
					}
				},
				{
					"include": "#comments"
				}
			]
		},
		"copy-command": {
			"begin": "^\\s*(copy)\\b",
			"beginCaptures": {
				"1": { "name": "keyword.control.kaguasm" }
			},
			"end": "$",
			"patterns": [
				{
					"match": "\\s+([@*]?(?:REG_\\w+|DISPLAY_\\w+|KEYBOARD_BUFFER|PROGRAM_COUNTER|SYS_ENERGY|FREE_\\w+|KERNEL_START|var:\\w+|-?\\d+))\\s+(to)\\s+(\\*?(?:REG_\\w+|DISPLAY_\\w+|KEYBOARD_BUFFER|PROGRAM_COUNTER|SYS_ENERGY|FREE_\\w+|KERNEL_START|var:\\w+|-?\\d+))",
					"captures": {
						"1": {
							"patterns": [
								{
									"match": "[@*]?var:\\w+",
									"name": "variable.other.kaguasm"
								},
								{
									"match": ".+",
									"name": "constant.numeric.kaguasm"
								}
							]
						},
						"2": { "name": "keyword.control.kaguasm" },
						"3": {
							"patterns": [
								{
									"match": "\\*?var:\\w+",
									"name": "variable.other.kaguasm"
								},
								{
									"match": ".+",
									"name": "constant.numeric.kaguasm"
								}
							]
						}
					}
				},
				{
					"include": "#comments"
				}
			]
		},
		"jump-commands": {
			"begin": "^\\s*(jump_if_not|jump_if|jump_err|jump)\\b",
			"beginCaptures": {
				"1": { "name": "keyword.control.kaguasm" }
			},
			"end": "$",
			"patterns": [
				{
					"match": "\\s+(\\*?(?:label:\\w+|-?\\d+)|\\*(?:var:\\w+|REG_\\w+|DISPLAY_\\w+|KEYBOARD_BUFFER|PROGRAM_COUNTER|SYS_ENERGY|FREE_\\w+|KERNEL_START))",
					"captures": {
						"1": {
							"patterns": [
								{
									"match": "\\*?label:\\w+",
									"name": "string.other.label.kaguasm"
								},
								{
									"match": "\\*var:\\w+",
									"name": "variable.other.kaguasm"
								},
								{
									"match": ".+",
									"name": "constant.numeric.kaguasm"
								}
							]
						}
					}
				},
				{
					"include": "#comments"
				}
			]
		},
		"label-declaration": {
			"begin": "^\\s*(label)\\s+(\\w+)",
			"beginCaptures": {
				"1": { "name": "keyword.control.kaguasm" },
				"2": { "name": "entity.name.function.kaguasm" }
			},
			"end": "$",
			"patterns": [
				{
					"include": "#comments"
				}
			]
		},
		"var-declaration": {
			"begin": "^\\s*(var)\\s+(\\w+)",
			"beginCaptures": {
				"1": { "name": "keyword.control.kaguasm" },
				"2": { "name": "variable.other.kaguasm" }
			},
			"end": "$",
			"patterns": [
				{
					"include": "#comments"
				}
			]
		},
		"standalone-commands": {
			"begin": "^\\s*(cpu_exec|DEBUG_ON|DEBUG_OFF)\\b",
			"beginCaptures": {
				"1": { "name": "keyword.control.kaguasm" }
			},
			"end": "$",
			"patterns": [
				{
					"include": "#comments"
				}
			]
		}
	},
	"scopeName": "source.kga"
}
